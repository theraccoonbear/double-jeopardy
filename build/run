#!/usr/bin/env bash

cd /opt/build

SSL_CERT_FILE=/opt/build/ssl/server.cert
SSL_KEY_FILE=/opt/build/ssl/server.key

echo "Looking for certificates"

ls -l $SSL_CERT_FILE
ls -l $SSL_KEY_FILE

if [ ! -f $SSL_CERT_FILE ] || [ ! -f $SSL_KEY_FILE ]; then
	echo "Generating and installing self-signed SSL certificate...";
	./install-ssl
fi

# PLACKUP=/usr/local/bin/plackup
# PERL_MONGO_NO_DEP_WARNINGS=1 perl -I /opt/src/modules/lib/perl5 $PLACKUP --server Twiggy::TLS --tls-key $SSL_KEY_FILE --tls-cert $SSL_CERT_FILE -R /opt/src/app/bin,/opt/src/app/lib -r /opt/src/app/bin/app.psgi
